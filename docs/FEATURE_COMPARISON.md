# Bash è„šæœ¬ vs Python é¡¹ç›®åŠŸèƒ½å¯¹æ¯”

## ğŸ“Š è„šæœ¬åŠŸèƒ½åˆ†ç±»

### âœ… å·²åœ¨ Python ä¸­å®ç°

#### 1. **mkmkv.sh** (ç²¾ç¡®åŒ¹é…)
- **åŠŸèƒ½**: å¤–éƒ¨å­—å¹•æ–‡ä»¶ç²¾ç¡®å‰ç¼€åŒ¹é…
- **ç‰¹ç‚¹**: 
  - æ–‡ä»¶åå¿…é¡»æœ‰ç›¸åŒå‰ç¼€
  - æ”¯æŒ 350+ è¯­è¨€ä»£ç æ˜ å°„
  - è¯­è¨€ä¼˜å…ˆçº§æ’åº
- **Python å¯¹åº”**: `SmartMatcher(method='ratio')` æˆ–è®¾ç½®é«˜é˜ˆå€¼
- **çŠ¶æ€**: âœ… å·²å®ç°

#### 2. **mkmkv_smart.sh** (æ™ºèƒ½åŒ¹é…)
- **åŠŸèƒ½**: å¤–éƒ¨å­—å¹•æ–‡ä»¶æ™ºèƒ½æ¨¡ç³ŠåŒ¹é…
- **ç‰¹ç‚¹**:
  - æ–‡ä»¶åè§„èŒƒåŒ–
  - Jaccard ç›¸ä¼¼åº¦ç®—æ³•
  - å¹²è¿è¡Œæ¨¡å¼
  - æ— éœ€æ‰‹åŠ¨æ”¹å
- **Python å¯¹åº”**: `SmartMatcher` ç±» + `cli.py`
- **çŠ¶æ€**: âœ… å·²å®ç°ï¼ˆåŠŸèƒ½æ›´å¼ºï¼‰

---

### âŒ Python ä¸­æœªå®ç°çš„åŠŸèƒ½

#### 3. **mkmkv_ç¹ç®€è‹±.sh / mkmkv_è‹±ç®€ç¹.sh / mkmkv_è‹±ç¹ç®€.sh**
- **åŠŸèƒ½**: é‡æ’è§†é¢‘å†…éƒ¨å·²å­˜åœ¨çš„å­—å¹•è½¨é“
- **ä½¿ç”¨åœºæ™¯**: 
  - å¤„ç†å·²åŒ…å«å¤šå­—å¹•çš„ MP4/MKV æ–‡ä»¶
  - è°ƒæ•´å­—å¹•æ˜¾ç¤ºé¡ºåºï¼ˆä¸æ·»åŠ æ–°å­—å¹•ï¼‰
- **æŠ€æœ¯å®ç°**:
  ```bash
  mkvmerge -o output.mkv \
    -s 2,3,4 \                    # é€‰æ‹©è½¨é“ 2,3,4ï¼ˆå­—å¹•ï¼‰
    --sub-charset 2:UTF-8 \
    --language 2:zh-Hant \
    --track-name 2:ç¹é«”ä¸­æ–‡ \
    input.mp4 \
    --track-order 0:0,0:1,0:4,0:5,0:2,0:3  # é‡æ’è½¨é“é¡ºåº
  ```
- **Python ç¼ºå¤±**: ä¸æ”¯æŒ `-s` (è½¨é“é€‰æ‹©) å’Œ `--track-order` (è½¨é“æ’åº)
- **çŠ¶æ€**: âŒ **æœªå®ç°**

#### 4. **mkmkv_è‹±è‹±ç®€ç¹.sh**
- **åŠŸèƒ½**: é‡æ’å­—å¹•è½¨é“ï¼ˆç‰¹æ®Šåœºæ™¯ï¼šåŒè‹±æ–‡å­—å¹•ï¼‰
- **ç‰¹ç‚¹**: å¤„ç†æœ‰ä¸¤ä¸ªè‹±æ–‡å­—å¹•çš„æƒ…å†µ
- **æŠ€æœ¯å®ç°**: åŒä¸Šï¼Œä½†é€‰æ‹© 4 ä¸ªå­—å¹•è½¨é“
- **Python ç¼ºå¤±**: åŒä¸Š
- **çŠ¶æ€**: âŒ **æœªå®ç°**

#### 5. **mkmkv_è°ƒæ•´éŸ³è½¨.sh**
- **åŠŸèƒ½**: é‡æ’ MKV æ–‡ä»¶çš„éŸ³è½¨é¡ºåº
- **ä½¿ç”¨åœºæ™¯**: 
  - åŸåœ°ä¿®æ”¹ MKV æ–‡ä»¶
  - äº¤æ¢éŸ³è½¨ä½ç½®ï¼ˆå¦‚å°†æ—¥è¯­éŸ³è½¨ç§»åˆ°å‰é¢ï¼‰
- **æŠ€æœ¯å®ç°**:
  ```bash
  mkvmerge -o temp.mkv \
    input.mkv \
    --track-order 0:0,0:1,0:3,0:2  # äº¤æ¢éŸ³è½¨ 2 å’Œ 3
  mv temp.mkv input.mkv
  ```
- **Python ç¼ºå¤±**: ä¸æ”¯æŒéŸ³è½¨é‡æ’å’ŒåŸåœ°ä¿®æ”¹
- **çŠ¶æ€**: âŒ **æœªå®ç°**

---

## ğŸ¯ åŠŸèƒ½è¦†ç›–ç‡

| åŠŸèƒ½ç±»åˆ« | Bash è„šæœ¬æ•°é‡ | Python å®ç° | è¦†ç›–ç‡ |
|---------|-------------|-----------|-------|
| å¤–éƒ¨å­—å¹•åŒ¹é… | 2 | âœ… 2 | 100% |
| å†…éƒ¨å­—å¹•é‡æ’ | 4 | âŒ 0 | 0% |
| éŸ³è½¨è°ƒæ•´ | 1 | âŒ 0 | 0% |
| **æ€»è®¡** | **7** | **2** | **28.6%** |

---

## ğŸ“‹ åŠŸèƒ½å·®å¼‚è¯¦è§£

### Python é¡¹ç›®çš„ä¼˜åŠ¿
1. âœ… **æ™ºèƒ½åŒ¹é…æ›´å‡†ç¡®**: rapidfuzz åº“å¤šç§ç®—æ³•ï¼ˆtoken_set, hybrid ç­‰ï¼‰
2. âœ… **é…ç½®æ–‡ä»¶æ”¯æŒ**: YAML é…ç½®ï¼Œæ˜“äºç®¡ç†
3. âœ… **ç±»å‹å®‰å…¨**: Python ç±»å‹æç¤º + mypy
4. âœ… **æµ‹è¯•è¦†ç›–**: 146 ä¸ªå•å…ƒæµ‹è¯•ï¼Œ90% è¦†ç›–ç‡
5. âœ… **è·¨å¹³å°**: ç»Ÿä¸€çš„ Python ç¯å¢ƒï¼Œæ— éœ€å¤„ç† Bash ç‰ˆæœ¬å·®å¼‚
6. âœ… **æ¨¡å—åŒ–è®¾è®¡**: å¯ä½œä¸ºåº“å¯¼å…¥ä½¿ç”¨

### Python é¡¹ç›®çš„ä¸è¶³
1. âŒ **åªå¤„ç†å¤–éƒ¨å­—å¹•**: æ— æ³•å¤„ç†è§†é¢‘å†…éƒ¨å·²æœ‰å­—å¹•
2. âŒ **ä¸æ”¯æŒè½¨é“é‡æ’**: ç¼ºå°‘ `--track-order` åŠŸèƒ½
3. âŒ **ä¸æ”¯æŒè½¨é“é€‰æ‹©**: ç¼ºå°‘ `-s` (select tracks) åŠŸèƒ½
4. âŒ **ä¸æ”¯æŒåŸåœ°ä¿®æ”¹**: æ— æ³•æ›¿æ¢åŸæ–‡ä»¶
5. âŒ **ä¸æ”¯æŒéŸ³è½¨è°ƒæ•´**: åªå¤„ç†å­—å¹•è½¨é“

---

## ğŸ”§ å»ºè®®å®ç°çš„åŠŸèƒ½

### é«˜ä¼˜å…ˆçº§
1. **è½¨é“é‡æ’åŠŸèƒ½** (å¯¹åº” 4 ä¸ªå›ºå®šé¡ºåºè„šæœ¬)
   ```python
   merger.reorder_tracks(
       input_file="movie.mkv",
       track_order=[0, 1, 4, 3, 2],  # è§†é¢‘, éŸ³é¢‘, å­—å¹•3, å­—å¹•2, å­—å¹•1
       output_file="movie_reordered.mkv"
   )
   ```

2. **è½¨é“é€‰æ‹©åŠŸèƒ½**
   ```python
   merger.merge(
       video_file="movie.mp4",
       select_tracks=[0, 1, 3],  # ä»…ä¿ç•™è§†é¢‘+éŸ³é¢‘+å­—å¹•3
       subtitle_tracks=[...],
       output_file="output.mkv"
   )
   ```

### ä¸­ä¼˜å…ˆçº§
3. **éŸ³è½¨è°ƒæ•´** (å¯¹åº” mkmkv_è°ƒæ•´éŸ³è½¨.sh)
   ```python
   merger.reorder_audio_tracks(
       input_file="movie.mkv",
       audio_order=[1, 0],  # äº¤æ¢å‰ä¸¤ä¸ªéŸ³è½¨
       in_place=True
   )
   ```

4. **åŸåœ°ä¿®æ”¹æ¨¡å¼**
   ```python
   merger.merge(..., in_place=True)  # æ›¿æ¢åŸæ–‡ä»¶
   ```

### ä½ä¼˜å…ˆçº§
5. **æ··åˆæ¨¡å¼**: åŒæ—¶å¤„ç†å†…éƒ¨å’Œå¤–éƒ¨å­—å¹•
   ```python
   merger.merge(
       video_file="movie.mp4",
       internal_subtitles=[2, 3],  # ä¿ç•™å†…éƒ¨å­—å¹•è½¨é“ 2,3
       external_subtitles=["sub1.srt", "sub2.srt"],
       output_file="output.mkv"
   )
   ```

---

## ğŸ’¡ å®ç°å»ºè®®

### æ¶æ„æ‰©å±•
```python
# merger.py æ–°å¢ç±»
class TrackManager:
    """è½¨é“ç®¡ç†å™¨ï¼ˆå¤„ç†å†…éƒ¨è½¨é“ï¼‰"""
    
    def get_tracks(self, file: str) -> List[Track]:
        """è·å–æ–‡ä»¶çš„æ‰€æœ‰è½¨é“ä¿¡æ¯"""
        # ä½¿ç”¨ mkvmerge -J file.mkv è·å– JSON ä¿¡æ¯
        
    def reorder_tracks(self, input_file: str, track_order: List[int], 
                      output_file: str) -> bool:
        """é‡æ’è½¨é“é¡ºåº"""
        
    def select_tracks(self, input_file: str, track_ids: List[int],
                     output_file: str) -> bool:
        """é€‰æ‹©ç‰¹å®šè½¨é“"""
        
class AudioManager(TrackManager):
    """éŸ³è½¨ç®¡ç†å™¨"""
    
    def swap_audio_tracks(self, file: str, track1: int, track2: int) -> bool:
        """äº¤æ¢ä¸¤ä¸ªéŸ³è½¨ä½ç½®"""
```

### é…ç½®æ–‡ä»¶æ‰©å±•
```yaml
# config.yaml
track_management:
  # è½¨é“é‡æ’è§„åˆ™
  reorder_enabled: false
  default_order: [0, 1, 2, 3]  # è§†é¢‘, éŸ³é¢‘, å­—å¹•1, å­—å¹•2
  
  # è½¨é“é€‰æ‹©è§„åˆ™
  audio_tracks: [0]  # ä»…ä¿ç•™ç¬¬ä¸€ä¸ªéŸ³è½¨
  subtitle_tracks: [2, 3]  # ä¿ç•™å­—å¹•è½¨é“ 2,3
  
  # åŸåœ°ä¿®æ”¹
  in_place_mode: false
  backup_original: true
```
